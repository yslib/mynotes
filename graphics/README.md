# 图形学

#### 切线空间
在用法线贴图的时候，如果表面的朝向和法线贴图的坐标系不一致的话结果就会有问题。

比如给一张法相贴图，如果不经过处理，那么这个贴图只能描述空间当中朝向特定方向的法线。切线空间就是把这个固定朝向的法线变换到另外一个朝向的矩阵。这个矩阵在实现raytracing的brdf中就用到了。

T(tangent)  切线。向右。

B(bitangent)  副切线。可以通过切线和法线求出来。

N(normal) 相当于z轴，永远朝上。
实际上是一种坐标变换。把局部坐标系（以正z轴为表面法线的法线贴图）中的法线变换到以用到这个法相贴图的物体的表面法向量为基准的全局坐标系中。这个矩阵的三个列就是TBN。相当于这个局部坐标系相对于世界坐标的基。

#### 视差贴图


#### PBR

>辐射通量 的单位是watt，也就是功率。从物理上来讲，光源的辐射通量是一个积分。表示的时候一般就用rgb表示。但是rgb与


#### 关于颜色的表示

颜色其实是一个能量分布的积分（单位watt）。比较精确的表示是这样的：

```
template<int nSamples>
struct Spectrum
{
    float c[nSamples];
};
```
这一些列系数其实是一个基的系数。比如用高斯函数作为基。这样的话，一个Spectrum示例就可以表示一个复杂的概率密度分布了。

还可以直接把这个数组当作能量分布的采样点，也就是把光谱能量分布S(λ)离散化。给定一个具有n个（波长，能量）的采样点，构造一个具有m个采样点的Spectrum。这里面涉及到一些简单的计算。也就是把n个采样点重新平均到m个采样点上。

#### 采样的颜色表示转换为RGB颜色表示

因为人的眼睛对三种颜色比较敏感，所以可以用三个分量来作为一组基表示颜色。这也是为什么好多颜色空间都用三个分量来表示。
我们知道一个光谱的能量分布为S(λ)，


# 变换和真实感相机
在图形学中所使用的MVP矩阵定量的描述了物体到投影平面的空间变换关系。从真实感绘制的角度来讲，还需要从光学的角度去模拟相机拍摄的成像过程。一般在真实感绘制中，我们需要在几何光学的层次上去模拟光线的传输，其中就包括光线在镜头中的传播以及成像的过程。
下面就简单的介绍一些光学模型。

最简单的就是**小孔成像**，这是一种最理想化的成像模型，只有一条光线能经过小孔。这种成像系统没有焦距，也就是可以在小孔后的任意距离上呈现清晰的像，考虑到光线的衰减，只会有明暗的不同。

然后就是**透镜成像**。这里又可以分为两种，第一种是单透镜，可以实现虚化(景深)效果。这里涉及到一些概念，包括光圈(aperture)，景深(depth of filed)，弥散圈(circle of confusion)。
景深的程度其实由弥散圈，传感器性质以及人眼的分辨率共同决定的。
给定一个成像平面位于zf'（不一定在焦点处），有其所对应的一个能够对焦在这个成像平面上的物体的距离zf。对焦的过程就是调节zf'的过程，当把成像平面调整到焦点的位置上时，就对焦在了无限远处，实际上就是能看清很远的地方。在zf的前后范围内，有一个能够成人眼能够分辨的清晰度的像的范围。这个范围就是景深（Depth of Field）在这个范围的前后的边界的位置上所成的像不能在成像平面上会聚成一点，而是一个有一定直径的光斑。这个圆圈就是弥散圈。(只需要简单的几何推导,弥散圈dc = func(z) = abs(d1*f*(z-zf)/(z(f+zf))，d1为光圈大小)如果我们把这个弥散圈当作一个衡量成像分辨率的指标，即当这个光斑大到一定程度，使得相机的传感器和人眼都不能识别出清晰的图像。那么给定一个弥散圈，就能确定在某位置物体的景深范围。这样的话，我们会有两个相同的解释方式：其他条件相同的情况下，相机的弥散圈越大（无论以怎样的方式实现，比如更高分辨率的成像传感器，或者是其他什么黑科技）景深越大，则成像清晰的范围就越大，越不容易产生模糊效果。与此等价的说法是：其他条件相同的情况下，景深越小，弥散圈越小。
公式dc= func(z) 的曲线形状类似于|log(x)|，func(z) = 0 的零点是 z = zf。给定一个相机的dc，在这个曲线上画一条横线，对应的两个z1,z2就是对焦在zf处物体的景深范围，可见前景深与后景深的变化不是对称的。d1对于这条曲线的影响就是在其他条件相同的情况下如果d1越大，那么这个曲线越收紧，对应的景深就越小，越容易产生虚化效果。

单个凸透镜头的成像系统可以摄影当中基本的概念。然而实际的单反相机的镜头是由多个透镜组成的。原因之一是可以实现变焦，同时多个透镜可以修正一个透镜引入的像差（这又是另外一个复杂的光学话题了），达到更好的成像效果。
在真实感绘制中引入了多这种多透镜的相机模拟，这样我们需要为每个透镜建模，为了简单我们假设每个透镜都是球面镜，这样我们只需要一个半径参数就能描述透镜的几何特征。实际的相机镜头中为了获得更好的成像效果，都会加入非球面透镜，这已经是比较现代的技术了。因为在理论上，球面透镜不能把光汇聚在一点，产生了球差。在真实感绘制中，我们只模拟球面镜。
一个透镜由四个参数决定：
**曲率半径** **厚度** **折射系数** **直径**
厚度是到下一个镜片的距离。


