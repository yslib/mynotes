<!doctype html><html lang=en><head><title>\[Engineering\] Squircle :: YSL Blog</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This article is aimed to help you implement the Figma&amp;rsquo;s corner smoothing effect step by step.
In design, rounded rectangle are a very common geometry used to enhance visual effects. Since iOS7, Apple proposed a new type of rounded icon that provide &amp;ldquo;pop&amp;rdquo; visual effect with something subtle around the corner. Initial reversing work comes from Marc Edwards, which reveals that this kind of contour might be governed by Superellipse $(\frac{x}{a})^n + (\frac{y}{b})^n = 1 $ with $n&amp;gt;2$
"><meta name=keywords content="Blog,Personal Website"><meta name=robots content="noodp"><link rel=canonical href=/post/graphics/bezier/><link rel=stylesheet href=/styles.css><link rel="shortcut icon" href=/img/theme-colors/white.png><link rel=apple-touch-icon href=/img/theme-colors/white.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content="Yang Shuoilu"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="\[Engineering\] Squircle"><meta property="og:description" content="This article is aimed to help you implement the Figma&amp;rsquo;s corner smoothing effect step by step.
In design, rounded rectangle are a very common geometry used to enhance visual effects. Since iOS7, Apple proposed a new type of rounded icon that provide &amp;ldquo;pop&amp;rdquo; visual effect with something subtle around the corner. Initial reversing work comes from Marc Edwards, which reveals that this kind of contour might be governed by Superellipse $(\frac{x}{a})^n + (\frac{y}{b})^n = 1 $ with $n&amp;gt;2$
"><meta property="og:url" content="/post/graphics/bezier/"><meta property="og:site_name" content="YSL Blog"><meta property="og:image" content="/img/favicon/white.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></head><body class=white><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>YSL Blog</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about/>About Me</a></li><li><a href=https://github.com/yslib>GitHub</a></li><li><a href=https://picysl.com>Photography</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about/>About Me</a></li><li><a href=https://github.com/yslib>GitHub</a></li><li><a href=https://picysl.com>Photography</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=/post/graphics/bezier/>[Engineering] Squircle</a></h1><div class=post-meta><span class=post-author>Yang Shuoilu</span></div><span class=post-tags>#<a href=/tags/graphics/>Graphics</a>&nbsp;
#<a href=/tags/bezier/>Bezier</a>&nbsp;
#<a href=/tags/design/>Design</a>&nbsp;</span><div class=post-content><div><p>This article is aimed to help you implement the <a href=https://www.figma.com/blog/desperately-seeking-squircles/>Figma&rsquo;s corner smoothing effect</a> step by step.</p><hr><p>In design, rounded rectangle are a very common geometry used to enhance visual effects. Since iOS7, Apple proposed a new type of rounded icon that provide &ldquo;pop&rdquo; visual effect with something subtle around the corner. Initial reversing work comes from Marc Edwards, which reveals that this kind of contour might be governed by <a href=https://mathworld.wolfram.com/Superellipse.html><strong>Superellipse</strong></a> $(\frac{x}{a})^n + (\frac{y}{b})^n = 1 $ with $n>2$</p><figure class=center><img src=img/superellipse.png alt=SuperEllipse style=border-radius:8px;width:400px><figcaption class=center>Superellipse $(\frac{x}{a})^5 + (\frac{y}{b})^5 = 1$ with $n=5$</figcaption></figure><p>However, it not true for what iOS really does. After many efforts, it seems that the iOS-style corner is made of a combination of cubic Bézier curve and arc segment. The blog from Figma proposed a method that how to parameterized the smooth. With the value varies between [0, 1], the corner varies from a full arc to Bézier curve. Moreover, it could also apply to the corner with arbitrary angle rather than the 90-degree corner. The exposition on the mathematical theory in the original blog is sufficient, but it is obscured by ornate rhetoric, which can leave readers who wish to delve deeper into its mathematical principles rather perplexed. This article mainly focuses on the theoretical details proposed in the original blog and provides detailed mathematical formulas for each section, allowing readers to easily implement them in code based on these formulas.</p><h2 id=0x00-prerequisite>0x00 Prerequisite:<a href=#0x00-prerequisite class=hanchor arialabel=Anchor>&#8983;</a></h2><ol><li><p>The definition of Bézier curves：</p><ul><li><a href=https://pomax.github.io/bezierinfo/>Here</a> is a good introduction on Bezier for beginners.</li></ul></li><li><p>Basic linear algebra:</p><ul><li>A basic concept on affine transformation.</li></ul></li></ol><h2 id=0x01-mathematics-perspective>0x01 Mathematics Perspective<a href=#0x01-mathematics-perspective class=hanchor arialabel=Anchor>&#8983;</a></h2><figure class=center><img src=img/rect.svg alt=Rect&amp;Squircle style=border-radius:8px;width:400px><figcaption class=center>Rounded Rectangle(Left) Squircle(Right)</figcaption></figure><p>Comparing two different kinds of rectangle, the squircle feels not as much abrupt as normal rounded rectangle at the joint between line and curve.
This aesthetic comes from what is called continuation, in more specifically and mathematically speaking, <strong>Curvature Continuation</strong>.
The necessary way to derive such a squircle is keeping the curvature continuation at the joint. Let&rsquo;s begin from the basic idea behind the squircle.</p><p>But it&rsquo;s far from enough to modeling a squirecle with the only condition mentioned above, since there are infinite curve combinations if specific curve form is not given. Considering simplicity in both mathematics and practice, Bezier curve (Cubic Bezier is enough for most scenarios) and circle, the most common and powerful tools in both engineering, computer graphics and 2D design, are adopted.</p><blockquote><p>In fact, the original author show his idea from a mathematical perspective, where he assumes an continuous curvature profile, and he try to get the final integral curve by the given curvature equation. The result curve is called <a href=https://en.wikipedia.org/wiki/Euler_spiral>Clothoid</a>, which is too complex and not in closed formed, far beyond out of our scenario.</p></blockquote><p>Since the most curves can be given by a elementary function is already curvature continuatous itself. The only thing need to be done is having the value of curvature of both segments equal at their joint. Just recall that the condition of derivable or continous function you have learned in your high school.</p><h2 id=0x02-components>0x02 Components<a href=#0x02-components class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Squircle corners are composed of an arc (part of circle) and two cubic Bézier curves at each end symmetrically. The proportion of Bézier curves included is controlled by a parameter, namely the smoothing. The smoothing ranges from 0 to 1. The larger the value, the longer Bézier curves are. When the value is 1, the arc part vanishes. When the value is 0, the arc is tangent with this angle, as the ordinary rounded angle used to be. As the smooth becomes larger, the length of arc part becomes less until smooth value is 1. Here is an illustration.</p><figure class=center><img src=img/smooth.gif alt="Hello Friend" style=border-radius:8px;width:400px></figure><h2 id=0x03-math-foundation>0x03 Math Foundation<a href=#0x03-math-foundation class=hanchor arialabel=Anchor>&#8983;</a></h2><p>This section gives the sufficency condition for the curvature continuation at each joint without too much detail.</p><figure class=center><img src=img/a1.png alt="Hello Friend" style=border-radius:8px;width:400px><figcaption class=center>Cubic Bezier and its control points distribution<div></div>(Source: Figma's blog)</figcaption></figure><p>As the figure shows, the point 1 and point 4 are the end points of cubic Bezier and the point 2 and 3 are its control points. If we want get a continuous curvature profile for our smoothing curve, two constraints are held at the same time:</p><h4 id=constraint-1>Constraint 1<a href=#constraint-1 class=hanchor arialabel=Anchor>&#8983;</a></h4><blockquote><p>$If$ $P_1$, $P_2$ and $P_3$ are collinear, $Then$ $\kappa_{p_1}(0)=0$ $\implies$, $Then$ the curvature continuation is held between straight line part and the Bezier part</p></blockquote><ul><li>$Proof:$</li></ul><p>We know that the curvature of parameterized curve is</p><p>$$\kappa(t) = \frac{\left| B&rsquo;(t) \times B&rsquo;&rsquo;(t) \right|}{\left| B&rsquo;(t) \right|^3}$$</p><p>Given the cubic Bezier $B(t) = (1 - t)^3 \cdot P_0 + 3 \cdot (1 - t)^2 \cdot t \cdot P_1 + 3 \cdot (1 - t) \cdot t^2 \cdot P_2 + t^3 \cdot P_3 $</p><p>The curvature of cubic Bezier at $P_0$ ($t = 0$) is</p><p>$$\kappa_{p_1}(0) = \frac{\left| B&rsquo;(0) \times B&rsquo;&rsquo;(0) \right|}{\left| B&rsquo;(0) \right|^3}
= \frac{\left| \left(6 \left(P_1-2 P_2+P_3\right)\right)\times \left(3 P_2-3 P_1\right)\right| }{27 \left| P_1-P_2\right| {}^3} $$</p><p>When $P_1$, $P_2$ and $P_3$ are collinear, the cross product of the numerator term equals $0$, so that $\kappa(0) = 0$ at $P_1$.</p><p><strong>Amazing!</strong></p><h4 id=constraint-2>Constraint 2<a href=#constraint-2 class=hanchor arialabel=Anchor>&#8983;</a></h4><blockquote><p>$If$ $P_1$, $P_2$ and $P_3$ are collinear $and$ $b = \frac{2}{3} \frac{(c^2+d^2)^\frac{3}{2}}{dR}$ $\implies$ $\kappa_{p_4}(1) = \frac{1}{R}$, $Then$ the curvature continuation is held between the Bezier part the Bezier part and the arc part.</p></blockquote><ul><li>$Proof:$</li></ul><p>Once we get the conclusion that $P_1$, $P_2$ and $P_3$ are collinear, we can put the curve at a special coordination for the further examnation. As above figure shows, we can simplify the representation of Bezier curve by the scalar $a$ $b$ $c$ and $d$ rather than using the vector $P_1$, $P_2$ and $P_3$, which reduces the complexity dramatically.</p><p>So when we put the curve at $P_1=(0, 0)$, and then $P_2=(a, 0)$ $P_3=(a+b,0)$ $P_4=(a+b+c,d)$ with respect to $a$, $b$, $c$ and $d$. Bezier curve $B(t)$ can be simplified as</p><p>$$ B(t) = ( t^3 (a+b+c)+3 (1-t) t^2 (a+b)+3 a (1-t)^2 t,d t^3 )$$</p><p>then the curvature at $P_4$ is</p><p>$$\kappa_{p_4}(1) = \frac{\left| B&rsquo;(1) \times B&rsquo;&rsquo;(1) \right|}{\left| B&rsquo;(1) \right|^3} = \frac{|(3c,3d) \times (6c-6b,6d)|}{|(3c,3d)|^\frac{3}{2}} = \frac{18|bd|}{|(3c,3d)|^\frac{3}{2}} = \frac{1}{R}$$</p><p>$deriving$</p><p>$$b = \frac{2}{3} \frac{(c^2+d^2)^\frac{3}{2}}{dR}$$</p><h4 id=smoothing-parameterized>Smoothing Parameterized<a href=#smoothing-parameterized class=hanchor arialabel=Anchor>&#8983;</a></h4><p>How we to control the visual effect of smoothing?</p><ol><li><p>Intuitively, we would like a form with respect to $s \in [0, 1] \mapsto $ $Shape[a,b,c,d]$, saying that we could compute a corresponding set of $a,b,c,d$ from a given $s$.</p></li><li><p>Besides $s$, it should also be a map with respect to the arc part radius $R$. Written as $[s, R] \mapsto$ $Shape[a,b,c,d]$</p></li><li><p>The map must be invertable so that we could deal with the maximum smoothing value that corner could be.</p></li></ol><p>Let&rsquo;s explain each of these individually.</p><p>Picture the following, imagine we increase $s$ from 0 for all the three angle of an equalateral triangle at the same time with equal rate, the Bezier part will consume all sides with equal rate. What&rsquo;s the smoothing angle looks like as the value increasing? And what&rsquo;s the maximum value going to be? If the initial radius is relatively small, $s$ could be 1. But If the initial radius is larger, the Bezier part will consume the straight line before the parameter is going to be 1, because the side of triangle has no more room for angle being smoothing. So the map must be with respect to $s$ and $R$, namely $ s, R \mapsto$ $a,b,c,d$. As mentioned above, for larger $R$, the valid range of $is$ cannot come to 1. How we resolve the maximum value of $s$? What we only need to do is let the map be invertable. Then by giving the maximum room for consuming of each single angle, we can calculate $s$ by $Shape(a,b,c,d, R)$ $\mapsto$ $s$.</p><p>For a normal rounded corner, if the angle is $\theta$, then the segments consume of the edge is $\frac{R}{\tan{\frac{\theta}{2}}}$ = $R\sqrt{\frac{1+\cos\theta}{1-\cos\theta}}$, keep it simple as much as possible, we just define the squircle corner consume edge is
$$
q=(1+s)R\sqrt{\frac{1+\cos\theta}{1-\cos\theta}}
$$</p><p>Above form meet the 1, 2 and 3 at the same time.</p><h3 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>&#8983;</a></h3><p>To get the curve with desired curvature profile, it&rsquo;s necessary to make $P_1$, $P_2$ and $P_3$ collinear and hold $b = \frac{2}{3} \frac{(c^2+d^2)^\frac{3}{2}}{dR}$.
In the next section, We will talk about how to code this step by step.</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/post/graphics/transform/><span class=button__icon>←</span>
<span class=button__text>\[Engineering\] Coordination Conversion in the Mathematical Perspective</span>
</a></span><span class="button next"><a href=/post/principia/physics/><span class=button__text>\[Principia\] Hamillton's Principle</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>